!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).WireService={})}(this,(function(e){"use strict";Symbol("x").toString();function t(e,t,i){i.mutated||(i.mutated=new Set,Promise.resolve().then(n.bind(void 0,e,i))),i.mutated.add(t)}function n(e,t){const n=new Set,i=t.mutated;var c,s;delete t.mutated,i.forEach(i=>{const c=function(e,t){let n=e[t.head];if(!t.tail)return n;const i=t.tail;for(let e=0,t=i.length;e<t&&null!=n;e++){const t=i[e];if("object"!=typeof n||!(t in n))return;n=n[t]}return n}(e,i);if(t.values[i.reference]===c)return;t.values[i.reference]=c;const s=t.listeners[i.head];for(let e=0,t=s.length;e<t;e++)n.add(s[e])}),c=n,s=t.values,c.forEach(e=>{const{listener:t,statics:n,reactives:i}=e,c=Object.create(null);if(i){const e=Object.keys(i);for(let t=0,n=e.length;t<n;t++){const n=e[t],r=s[i[n]];c[n]=r}}const r=Object.assign({},n,c);t.call(void 0,r)})}function i(e,n,i){const c=t.bind(void 0,e,n,i),s=function(e,t,n){const i=function e(t,n,i){if(i=i||[],!t||i.indexOf(t)>-1)return null;const c=Object.getOwnPropertyDescriptor(t,n);if(c)return c;const s=Object.getPrototypeOf(t);if(!s)return null;return i.push(t),e(s,n,i)}(e,t);let c,s,r;if(null===i||void 0===i.get&&void 0===i.set){let i=e[t];c=!0,s=function(){return i},r=function(e){i=e,n()}}else{const{set:t,get:o}=i;c=i.enumerable,r=function(i){t&&t.call(e,i),n()},s=function(){return o?o.call(e):void 0}}return{set:r,get:s,enumerable:c,configurable:!0}}(e,n.head,c);Object.defineProperty(e,n.head,s)}class c{constructor(e){this.type="ValueChangedEvent",this.value=e}}class s{constructor(e,t){this.type="LinkContextEvent",this.uid=e,this.callback=t}}function r(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function o(e){if(!e.includes("."))return{reference:e,head:e};const t=e.split(".");return{reference:e,head:t.shift(),tail:t}}class a{constructor(e,t,n,i,c){this._cmp=e,this._def=t,this._context=n,this._wireDef=i,this._wireTarget=c}addEventListener(e,n){switch(e){case"connect":this._context["@wire"].connected.push(n);break;case"disconnect":this._context["@wire"].disconnected.push(n);break;case"config":{const e=this._wireDef.params,c=this._wireDef.static;let s;if(!e||0===(s=Object.keys(e)).length){const e=c||Object.create(null);return void n.call(void 0,e)}const r={listener:n,statics:c,reactives:e},a=this._context["@wire"].updated;s.forEach(n=>{const c=o(e[n]);let s=a.listeners[c.head];s?s.push(r):(s=[r],a.listeners[c.head]=s,i(this._cmp,c,a)),t(this._cmp,c,a)});break}default:throw new Error(`unsupported event type ${e}`)}}removeEventListener(e,t){switch(e){case"connect":r(this._context["@wire"].connected,t);break;case"disconnect":r(this._context["@wire"].disconnected,t);break;case"config":{const e=this._context["@wire"].updated.listeners,n=this._wireDef.params;n&&Object.keys(n).forEach(i=>{const c=o(n[i]),s=e[c.head];s&&function(e,t){for(let n=0,i=e.length;n<i;n++)if(e[n].listener===t)return void e.splice(n,1)}(s,t)});break}default:throw new Error(`unsupported event type ${e}`)}}dispatchEvent(e){if(e instanceof c){const t=e.value;return this._wireDef.method?this._cmp[this._wireTarget](t):this._cmp[this._wireTarget]=t,!1}if(e instanceof s){const{uid:t,callback:n}=e,i=new CustomEvent(t,{bubbles:!0,composed:!0,detail(...e){n(...e)}});return this._cmp.dispatchEvent(i),!1}if("wirecontextevent"===e.type)return this._cmp.dispatchEvent(e);throw new Error(`Invalid event ${e}.`)}}const d=new Map;function l(e){for(let t=0,n=e.length;t<n;++t)e[t].call(void 0)}const u={wiring:(e,t,n,i)=>{const c=i["@wire"]=Object.create(null);c.connected=[],c.disconnected=[],c.updated={listeners:{},values:{}};const s=n.wire,r=Object.keys(s);for(let t=0,c=r.length;t<c;t++){const c=r[t],o=s[c],l=d.get(o.adapter);if(l){const t=new a(e,n,i,o,c);l({dispatchEvent:t.dispatchEvent.bind(t),addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)})}}},connected:(e,t,n,i)=>{let c;n.wire&&(c=i["@wire"].connected)&&l(c)},disconnected:(e,t,n,i)=>{let c;n.wire&&(c=i["@wire"].disconnected)&&l(c)}};e.LinkContextEvent=s,e.ValueChangedEvent=c,e.register=function(e,t){d.set(e,t)},e.registerWireService=function(e){e(u)},Object.defineProperty(e,"__esModule",{value:!0})}));
